---
import BaseLayout from "../layouts/BaseLayout.astro";
import Section from "../components/ui/Section.astro";
import Hero from "../components/home/Hero.astro";
import NavTiles from "../components/home/NavTiles.astro";
import FeaturedMenu from "../components/home/FeaturedMenu.astro";
import LatestNews from "../components/home/LatestNews.astro";
import FAQTeaser from "../components/home/FAQTeaser.astro";
import Container from "../components/layout/Container.astro";
import { getCollection } from "astro:content";
import { resolvePublishedDate } from "../lib/resolvePublishedDate";

// æœ€æ–°3ä»¶ã®ãŠçŸ¥ã‚‰ã›ã‚’å–å¾—
const raw = await getCollection("news", ({ data }) => !data.draft);
const latestNews = raw
  .map((p) => ({
    ...p,
    publishedAt: resolvePublishedDate(p, "src/content/news"),
  }))
  .sort((a, b) => {
    const diff = b.publishedAt.getTime() - a.publishedAt.getTime();
    if (diff !== 0) return diff;
    return b.slug.localeCompare(a.slug);
  })
  .slice(0, 3);

const navTiles = [
  { icon: "ğŸ—", label: "Menu", href: "/menu/", description: "å…¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¦‹ã‚‹" },
  { icon: "ğŸ“…", label: "Schedule", href: "/schedule/", description: "å‡ºåº—ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«" },
  { icon: "ğŸ“", label: "Access", href: "/access/", description: "åº—èˆ—æƒ…å ±" },
  { icon: "ğŸ›’", label: "Order", href: "/order/", description: "äºˆç´„ãƒ»å–ã‚Šç½®ã" },
  { icon: "ğŸ“°", label: "News", href: "/news/", description: "ãŠçŸ¥ã‚‰ã›" },
  { icon: "â“", label: "FAQ", href: "/faq/", description: "ã‚ˆãã‚ã‚‹è³ªå•" },
];

const menuItems = [
  {
    name: "ã‚¸ãƒ£ãƒ¼ã‚¯ãƒã‚­ãƒ³ï¼ˆ1/2ï¼‰",
    description: "ãƒã‚­ãƒ³åŠèº« + ãƒ©ã‚¤ã‚¹&ãƒ”ãƒ¼ã‚º + ã‚µãƒ©ãƒ€",
    price: "1,200",
    spice: "ãƒã‚¤ãƒ«ãƒ‰/ãƒ›ãƒƒãƒˆ",
  },
  {
    name: "ã‚¸ãƒ£ãƒ¼ã‚¯ãƒã‚­ãƒ³ï¼ˆ1æšï¼‰",
    description: "ãƒã‚­ãƒ³1æš + ãƒ©ã‚¤ã‚¹&ãƒ”ãƒ¼ã‚º + ã‚µãƒ©ãƒ€",
    price: "2,000",
    spice: "ã‚¹ãƒ‘ã‚¤ã‚·ãƒ¼",
  },
  {
    name: "ãƒ©ã‚¤ã‚¹&ãƒ”ãƒ¼ã‚ºå˜å“",
    description: "ã‚³ã‚³ãƒŠãƒƒãƒ„ãƒ©ã‚¤ã‚¹ã¨è±†ã®ã‚¸ãƒ£ãƒã‚¤ã‚«é¢¨",
    price: "400",
    spice: "ãŠå­æ§˜å‘ã‘",
  },
];
---

<BaseLayout
  title="Jerk Chicken Stand - ç‚­ç«é¦™ã‚‹ã€æœ¬æ°—ã®ã‚¸ãƒ£ãƒ¼ã‚¯ãƒã‚­ãƒ³ã€‚"
  description="æœ¬æ ¼ã‚¸ãƒ£ãƒã‚¤ã‚«æ–™ç†ã®ã‚¸ãƒ£ãƒ¼ã‚¯ãƒã‚­ãƒ³å°‚é–€ã®ç§»å‹•è²©å£²ã€‚ã‚¹ãƒ‘ã‚¤ã‚·ãƒ¼ã§é¦™ã‚Šé«˜ã„ãƒã‚­ãƒ³ã¨ãƒ©ã‚¤ã‚¹&ãƒ”ãƒ¼ã‚ºã€‚éƒ½å†…å„æ‰€ã«å‡ºåº—ä¸­ã€‚äºˆç´„ãƒ»ã‚±ãƒ¼ã‚¿ãƒªãƒ³ã‚°ã‚‚å¯¾å¿œã—ã¾ã™ã€‚"
>
  <!-- Hero Section -->
  <Section variant="plain" style="padding: var(--space-20) 0; background: linear-gradient(135deg, rgba(220, 38, 38, 0.85) 0%, rgba(153, 27, 27, 0.85) 100%), url('/assets/images/common/hero.webp'); background-size: cover; background-position: center;">
    <Container>
      <Hero
        title="ç‚­ç«é¦™ã‚‹ã€æœ¬æ°—ã®ã‚¸ãƒ£ãƒ¼ã‚¯ãƒã‚­ãƒ³ã€‚"
        subtitle="ã‚¹ãƒ‘ã‚¤ã‚·ãƒ¼ã§é¦™ã‚Šé«˜ã„ã€æœ¬æ ¼ã‚¸ãƒ£ãƒã‚¤ã‚«æ–™ç†ã‚’éƒ½å†…å„æ‰€ã§æä¾›ä¸­"
        description="å‡ºåº—ãƒ»äºˆç´„ãƒ»ã‚±ãƒ¼ã‚¿ãƒªãƒ³ã‚°ã€‚å¥½ããªå ´æ‰€ã§ã€å¥½ããªæ™‚ã«ã€‚"
        image="/assets/images/common/hero.webp"
        badges={["ç§»å‹•è²©å£²", "æœ¬æ ¼ã‚¸ãƒ£ãƒã‚¤ã‚«æ–™ç†"]}
        primaryCta={{ label: "å‡ºåº—ã‚’è¦‹ã‚‹", href: "/schedule/" }}
        secondaryCta={{ label: "ä»Šã™ãäºˆç´„", href: "/order/" }}
        nextEvent="2æœˆ5æ—¥ï¼ˆæ°´ï¼‰ æ¸‹è°·ãƒãƒ«ã‚¤å‰åºƒå ´ 11:00-15:00"
      />
    </Container>
  </Section>

  <!-- Navigation Tiles Section -->
  <Section variant="alternate" style="padding: var(--space-16) 0;">
    <Container>
      <h2 style="text-align: center; margin-bottom: var(--space-12);">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ»æƒ…å ±</h2>
      <NavTiles tiles={navTiles} />
    </Container>
  </Section>

  <!-- Featured Menu Section -->
  <Section variant="plain" style="padding: var(--space-16) 0;">
    <Container>
      <h2 style="text-align: center; margin-bottom: var(--space-12);">äººæ°—ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h2>
      <FeaturedMenu items={menuItems} />
    </Container>
  </Section>

  <!-- Brand Message Section -->
  <Section variant="brand" style="padding: var(--space-16) 0; text-align: center;">
    <Container>
      <h2 style="color: white; margin-bottom: var(--space-6);">ã‚¤ãƒ™ãƒ³ãƒˆãƒ»å¤§é‡æ³¨æ–‡ã‚‚å¯¾å¿œ</h2>
      <p style="color: rgba(255, 255, 255, 0.95); max-width: 600px; margin: 0 auto var(--space-8); font-size: var(--text-lg);">
        ä¼šç¤¾ã®ãƒ©ãƒ³ãƒã€ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã€ã‚¤ãƒ™ãƒ³ãƒˆå‡ºåº—â€¦å¤§é‡æ³¨æ–‡ãƒ»ã‚±ãƒ¼ã‚¿ãƒªãƒ³ã‚°ã¯ãŠæ°—è»½ã«ã”ç›¸è«‡ãã ã•ã„ã€‚
      </p>
      <a href="/order/" class="btn btn-secondary">
        è©³ã—ãè¦‹ã‚‹ â†’
      </a>
    </Container>
  </Section>

  <!-- Latest News Section -->
  <Section variant="plain" style="padding: var(--space-16) 0;">
    <Container>
      <h2 style="text-align: center; margin-bottom: var(--space-12);">æœ€æ–°æƒ…å ±</h2>
      {latestNews.length > 0 ? (
        <LatestNews posts={latestNews} />
      ) : (
        <p style="text-align: center; color: var(--muted);">ãŠçŸ¥ã‚‰ã›ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
      )}
      <p style="text-align: center; margin-top: var(--space-8);">
        <a href="/news/" class="btn btn-outline">
          å…¨ã¦ã®ãŠçŸ¥ã‚‰ã›ã‚’è¦‹ã‚‹ â†’
        </a>
      </p>
    </Container>
  </Section>

  <!-- FAQ Teaser Section -->
  <Section variant="alternate" style="padding: var(--space-16) 0;">
    <Container>
      <FAQTeaser />
    </Container>
  </Section>
</BaseLayout>

<style>
  :global(.site-section.brand) {
    background: var(--brand);
    color: white;
  }

  :global(.site-section.alternate) {
    background: var(--surface);
  }
</style>
