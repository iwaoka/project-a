---
import { getCollection } from "astro:content";
import { resolvePublishedDate } from "../../lib/resolvePublishedDate";
import BaseLayout from "../../layouts/BaseLayout.astro";
import Section from "../../components/ui/Section.astro";
import Container from "../../components/layout/Container.astro";

export async function getStaticPaths() {
  const posts = await getCollection("news", ({ data }) => !data.draft);
  return posts.map((p) => ({
    params: { slug: p.slug },
    props: { post: p, publishedAt: resolvePublishedDate(p, "src/content/news") },
  }));
}

const { post, publishedAt } = Astro.props;
const { Content } = await post.render();
---

<BaseLayout title={post.data.title} description={post.data.description}>
  <Section variant="plain" style="padding: var(--space-12) 0; background: linear-gradient(135deg, var(--brand) 0%, var(--brand-dark) 100%); color: white;">
    <Container>
      <p style="color: rgba(255, 255, 255, 0.9); margin-bottom: var(--space-2);">
        <a href="/news/" style="color: var(--accent);">← お知らせ一覧へ</a>
      </p>
      <h1 style="color: white; margin-bottom: var(--space-3);">{post.data.title}</h1>
      <p style="color: rgba(255, 255, 255, 0.8); margin: 0;">
        {publishedAt.toLocaleDateString("ja-JP")}
      </p>
    </Container>
  </Section>

  <Section variant="plain">
    <Container>
      <article style="max-width: 800px; margin: 0 auto; margin-top: var(--space-12);">
        <Content />
      </article>
      <div style="margin-top: var(--space-12); text-align: center;">
        <a href="/news/" class="btn btn-outline">← お知らせ一覧へ</a>
      </div>
    </Container>
  </Section>
</BaseLayout>
